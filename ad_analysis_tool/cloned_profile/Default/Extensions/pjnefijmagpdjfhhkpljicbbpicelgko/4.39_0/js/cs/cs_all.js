(function(){"use strict";const se=["classroom.google.com","outlook.live.com","docs.google.com","meet.google.com","translate.google.com","discord.com","www.messenger.com","www.linkedin.com","quizlet.com","www.teamwork.com","www.instagram.com","www.carousell.com.hk","outlook.office.com","outlook.office365.com","web.whatsapp.com","dictanote.co","localhost:8000","mail.yahoo.com","www.bing.com","www.twitch.tv","www.youtube.com","www.facebook.com","www.twitter.com","x.com","www.reddit.com","www.pinterest.com","www.google.com","www.google.ad","www.google.ae","www.google.com.af","www.google.com.ag","www.google.com.ai","www.google.al","www.google.am","www.google.co.ao","www.google.com.ar","www.google.as","www.google.at","www.google.com.au","www.google.az","www.google.ba","www.google.com.bd","www.google.be","www.google.bf","www.google.bg","www.google.com.bh","www.google.bi","www.google.bj","www.google.com.bn","www.google.com.bo","www.google.com.br","www.google.bs","www.google.bt","www.google.co.bw","www.google.by","www.google.com.bz","www.google.ca","www.google.cd","www.google.cf","www.google.cg","www.google.ch","www.google.ci","www.google.co.ck","www.google.cl","www.google.cm","www.google.cn","www.google.com.co","www.google.co.cr","www.google.com.cu","www.google.cv","www.google.com.cy","www.google.cz","www.google.de","www.google.dj","www.google.dk","www.google.dm","www.google.com.do","www.google.dz","www.google.com.ec","www.google.ee","www.google.com.eg","www.google.es","www.google.com.et","www.google.fi","www.google.com.fj","www.google.fm","www.google.fr","www.google.ga","www.google.ge","www.google.gg","www.google.com.gh","www.google.com.gi","www.google.gl","www.google.gm","www.google.gr","www.google.com.gt","www.google.gy","www.google.com.hk","www.google.hn","www.google.hr","www.google.ht","www.google.hu","www.google.co.id","www.google.ie","www.google.co.il","www.google.im","www.google.co.in","www.google.iq","www.google.is","www.google.it","www.google.je","www.google.com.jm","www.google.jo","www.google.co.jp","www.google.co.ke","www.google.com.kh","www.google.ki","www.google.kg","www.google.co.kr","www.google.com.kw","www.google.kz","www.google.la","www.google.com.lb","www.google.li","www.google.lk","www.google.co.ls","www.google.lt","www.google.lu","www.google.lv","www.google.com.ly","www.google.co.ma","www.google.md","www.google.me","www.google.mg","www.google.mk","www.google.ml","www.google.com.mm","www.google.mn","www.google.ms","www.google.com.mt","www.google.mu","www.google.mv","www.google.mw","www.google.com.mx","www.google.com.my","www.google.co.mz","www.google.com.na","www.google.com.ng","www.google.com.ni","www.google.ne","www.google.nl","www.google.no","www.google.com.np","www.google.nr","www.google.nu","www.google.co.nz","www.google.com.om","www.google.com.pa","www.google.com.pe","www.google.com.pg","www.google.com.ph","www.google.com.pk","www.google.pl","www.google.pn","www.google.com.pr","www.google.ps","www.google.pt","www.google.com.py","www.google.com.qa","www.google.ro","www.google.ru","www.google.rw","www.google.com.sa","www.google.com.sb","www.google.sc","www.google.se","www.google.com.sg","www.google.sh","www.google.si","www.google.sk","www.google.com.sl","www.google.sn","www.google.so","www.google.sm","www.google.sr","www.google.st","www.google.com.sv","www.google.td","www.google.tg","www.google.co.th","www.google.com.tj","www.google.tl","www.google.tm","www.google.tn","www.google.to","www.google.com.tr","www.google.tt","www.google.com.tw","www.google.co.tz","www.google.com.ua","www.google.co.ug","www.google.co.uk","www.google.com.uy","www.google.co.uz","www.google.com.vc","www.google.co.ve","www.google.vg","www.google.co.vi","www.google.com.vn","www.google.vu","www.google.ws","www.google.rs","www.google.co.za","www.google.co.zm","www.google.co.zw","www.google.cat","chat.openai.com","chatgpt.com","teams.microsoft.com","classx.org","gemini.google.com","www.overleaf.com","www.notion.so","www.remnote.com","chat.mistral.ai","copilot.microsoft.com","www.perplexity.ai","huggingface.co","character.ai","grok.com","aistudio.google.com","chat.deepseek.com","www.meta.ai","chat.qwenlm.ai","app.gradally.com","www.duolingo.com","github.com","flowgpt.com"],we=[".instructure.com","canvas."];function ge(e){return se.indexOf(e)!==-1||we.some(w=>e.includes(w))}const me=[".zendesk.com",".force.com",".salesforce.com",".salesforce-sites.com",".hubspot.com","app.jasper.ai",".athenahealth.com",".atlassian.net",".simplepractice.com",".slack.com",".webpt.com",".clickup.com",".therapynotes.com",".clinicient.com",".qualtrics.com",".freshdesk.com",".sharepoint.com",".service-now.com",".site.com",".freshchat.com",".logisticsbackoffice.com",".kipuworks.com",".ecwcloud.com",".followupboss.com",".pipedrive.com",".intercom.com","doctornow.io",".moderationinterface.com",".versncr.com",".kareo.com",".growtherapy.com",".drchrono.com",".gohighlevel.com",".redtailtechnology.com",".heimlich.com","otranscribe.com",".gold-chat.net","app.asana.com",".practicefusion.com",".intuit.com",".intellect.com","dynamics.microsoft.com",".oracle.com",".sap.com",".sugarcrm.com",".freshworks.com",".insightly.com",".bitrix24.com",".creatio.com",".netsuite.com",".odoo.com",".vtiger.com",".teledentix.com",".mouthwatch.com",".dentulu.com",".denteractive.com",".toothpic.com",".virtualdentalcare.com",".smilevirtual.com",".aligntech.com",".candidco.com",".ortholive.com","theranest.com",".valant.io",".therapyappointment.com","luminello.com","counsol.com",".myclientsplus.com",".eclinicalworks.com",".advancedmd.com",".cerner.com",".meditech.com",".epic.com",".nextgen.com",".chargebee.com",".zoominfo.com",".shopify.com",".wordpress.com",".wordpress.org",".zoho.com",".apptivo.com",".act.com",".salesmate.io",".nimble.com",".close.com",".copper.com",".keap.com",".agilecrm.com","capsulecrm.com",".lessannoyingcrm.com",".pipelinecrm.com",".nutshell.com","salesflare.com","highrisehq.com",".pipelinercrm.com",".wrike.com",".smartsheet.com",".monday.com",".redbooth.com",".basecamp.com",".teamwork.com",".podio.com",".backlog.com",".proofhub.com",".livechat.com",".helpscout.net",".tidio.com",".crisp.chat",".olark.com",".kayako.com",".liveagent.com",".userlike.com",".happyfox.com",".freshcaller.com",".proton.me",".fastmail.com",".hiverhq.com",".spikenow.com",".superhuman.com",".missiveapp.com",".frontapp.com",".hey.com",".zimbra.com",".peopleperhour.com",".truelancer.com",".freelancer.com",".upwork.com",".guru.com",".fiverr.com",".upwork.com",".toptal.com",".weworkremotely.com",".codeable.io",".cloudpeeps.com",".gocatalant.com",".lever.co",".indeed.com",".outreach.io",".greenhouse.io",".loom.com",".miro.com",".coda.io",".asktetra.com",".otter.ai"];function de(){const e=document.createElement("div");return e.setAttribute("id","voicein-notification"),e.style.display="none",document.documentElement.appendChild(e),e}function pe(e){return e==="warning"?`<svg title="warning icon" width="1em" height="1em" style="fill: #333" aria-hidden="true" version="1.2" baseProfile="tiny" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
<path d="M12 5.511c.561 0 1.119.354 1.544 1.062l5.912 9.854c.851 1.415.194 2.573-1.456 2.573h-12c-1.65 0-2.307-1.159-1.456-2.573l5.912-9.854c.425-.708.983-1.062 1.544-1.062m0-2c-1.296 0-2.482.74-3.259 2.031l-5.912 9.856c-.786 1.309-.872 2.705-.235 3.83s1.879 1.772 3.406 1.772h12c1.527 0 2.77-.646 3.406-1.771s.551-2.521-.235-3.83l-5.912-9.854c-.777-1.294-1.963-2.034-3.259-2.034z"></path>
<circle cx="12" cy="16" r="1.3"></circle>
<path d="M13.5 10c0-.83-.671-1.5-1.5-1.5s-1.5.67-1.5 1.5c0 .199.041.389.111.562.554 1.376 1.389 3.438 1.389 3.438l1.391-3.438c.068-.173.109-.363.109-.562z"></path>
</svg>`:""}async function ue(e,w="warning",h=1e4){w=w||"warning",h=h||1e4;let d=document.querySelector("#voicein-notification"),u;if(d)u=d.shadowRoot;else{d=de(),u=d.attachShadow({mode:"open"});const k=document.createElement("link");k.rel="stylesheet",k.href=chrome.runtime.getURL("css/notification.css");const S=new Promise((K,z)=>{k.onload=K,k.onerror=z});u.appendChild(k);const E=`
a.external::after {
  content: '';
  width: 1em;
  height: 0.7em;
  padding-right: 0.5em;
  display: inline-block;
  position: relative;
  background-size: 100% 100% !important;
  background: url("${chrome.runtime.getURL("images/external-link.svg")}") no-repeat center;
  background-size: contain;
}
`,A=document.createElement("style");A.textContent=E,u.appendChild(A),await S;const x=document.createElement("div");x.setAttribute("class","box_container"),x.innerHTML=`
  <div class='box'>${pe(w)}
    <span id='title'></span>
    <button id='close-btn' aria-label="close">[x]</button>
  </div>`,u.appendChild(x),u.querySelector("#close-btn").onclick=()=>{d.style.display="none"}}e=e||'You need to upgrade to <a href="https://dictanote.co/voicein/plus/">Voice In Plus</a> to use this command.';const T=u.querySelector("#title");T.innerHTML=e,d.style.display="block",setTimeout(()=>{d.style.display="none"},h)}function X(e,w,h){window.scrollTo({behavior:"smooth",top:h})}function fe(e){const w=document.querySelectorAll('a, button, div[role="button"]');for(let h of w)if(h.textContent.trim().toLowerCase()===e){h.click();return}ue(`No ${e} button or link found on this page.`,"info",2e3),console.error(`No "${e}" button or link found on this page.`)}function H(e){try{return localStorage[e]}catch{return null}}const N=" ";String.prototype.replaceAll||(String.prototype.replaceAll=function(e,w){return this.split(e).join(w)});function y(...e){H("viDebug")==="true"&&console.log("[VI]",...e)}function he(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}let b;const ae=[".","?","!",`
`],B=/(<[a-zA-Z0-9:+-_]+?>)/g;let I=!1;var O=!1;let ee=!1,W=!1,M=!1,P="",_=!1,L=!1,Y=!1,f="",G="";const be=["www.notion.so","www.youtube.com","classroom.google.com","wordpress.com","dictanote.co","localhost:8000","app.slack.com","www.deepl.com","app.gohighlevel.com","crm.eldersell.com","hemingwayapp.com","app.gitbook.com","www.ebay.com","x.com","admin.shopify.com"],ye=[];let j="";function ve(){chrome.runtime.onMessage.addListener(e=>{try{y(e),ke(e)}catch(w){console.error(w),te(w)}}),y("cs_all loaded"),document.body&&document.body.classList.contains("voicein_ready")&&document.body.classList.remove("voicein_ready")}async function ke(e){switch(e.action){case"tab_activated":{e.recognizing&&(e.url&&(P=e.url),_||(_=!0,await q()));break}case"tab_url_change":{e.recognizing&&(e.url&&(P=e.url),_||(_=!0,await q()));break}case"on_results":{e.url&&(P=e.url),j=e.lang,_||(_=!0,await q()),Me(e.txtToAdd,e.cursorLock);break}case"on_interim_results":{G=e.txtToAdd;break}case"recognition_started_in_bg":e.url&&(P=e.url),_||(_=!0,await q());break;case"user_update":{e.url&&(P=e.url),e.pro&&(_=!0,await q());break}case"update_change_case":{L=e.changeCase;break}}}function Ee(e,w){return e==="docs.google.com"&&(w.startsWith("/document/")||w.startsWith("/presentation/"))||e==="writer.zoho.com"||e==="blog.naver.com"}function Te(e,w){chrome.runtime.sendMessage({message_id:"mp_track",category:e,info:w})}function te(e){const w=(P||window.location.href||"").slice(0,60);let h="";e.stack&&(h+=e.stack.substring(0,300).split(`
`).join("")),Te("JSError-CSA",{action:e.toString(),label:h,url:w})}function Z(e){return new Promise(w=>setTimeout(w,e))}function U(){try{let e=window.location;return(e.host===""||e.protocol!=="http:"&&e.protocol!=="https:")&&(e=new URL(P)),e.host}catch{return"unknown.com"}}function xe(){try{return new URL(P).host}catch{return"unknown.com"}}function Ce(){try{let e=window.location;return(e.host===""||e.protocol!=="http:"&&e.protocol!=="https:")&&(e=new URL(P)),e.pathname}catch{return"unknown.com"}}function Ne(){let e=document.activeElement;if(!e||e.tagName==="IFRAME")return null;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function V(){const e=document.activeElement;return!e||e.tagName==="IFRAME"?null:document}function ce(){let e=document.activeElement,w=document;if(!e||e.tagName==="IFRAME")return null;for(;e&&e.shadowRoot;)w=e.shadowRoot,e=e.shadowRoot.activeElement;return w}function le(){const e=document.activeElement;return!e||e.tagName==="IFRAME"?null:window}function Se(){const e=Ne();let w=!1;return e&&(e.nodeName==="INPUT"||e.nodeName==="TEXTAREA"||e.isContentEditable)&&document.hasFocus()&&(w=!0),{targetable:w,target:e}}const D={backspace:8,return:13,z:90};function oe(e,w){let h=e.ownerDocument,d=!1;const u={data:null,bubbles:!0,composed:!0,cancelable:!0,isComposing:!1};function T(E,A){return new window.InputEvent(E,A)}function k(E,A,x,K=!1,z=!1,R=!1,$=!1){return new KeyboardEvent(E,{key:A,code:`Key${A.toUpperCase()}`,keyCode:x,charCode:x,windowsVirtualKeyCode:x,nativeVirtualKeyCode:x,macCharCode:x,unmodifiedText:A,text:A,ctrlKey:K,metaKey:z,shiftKey:R,altKey:$,bubbles:!0,cancelable:!0})}function S(E){y("[EVENT DISPATCHED]",E.type,E),e.dispatchEvent(E)}if(w.keyCode===D.backspace){if(w.type==="input")return;u.inputType="deleteContentBackward",d=T(w.type,u)}else w.keyCode===D.return?e instanceof window.HTMLInputElement?w.type==="beforeinput"&&(u.inputType="insertLineBreak",d=T(w.type,u)):w.type==="input"?h.execCommand("insertParagraph"):w.type==="beforeinput"?(u.inputType="insertParagraph",d=T(w.type,u)):(u.data=`
`,d=T(w.type,u)):w.keyCode===D.z&&(w.ctrlKey||w.metaKey)&&(d=k(w.type,"z",D.z,w.ctrlKey,w.metaKey));if(d)return S(d),d.defaultPrevented}function Ae(e){function w(t){return t.replace(/\S/,o=>o.toUpperCase())}function h(t){for(let o=0;o<ae.length;o+=1){const n=ae[o];if(t.slice(t.length-n.length)===n)return!0}return!1}function d(t,o){let n="";switch(t.tagName){case"INPUT":case"TEXTAREA":{const l=t.value,c=t.selectionStart,i=Math.max(0,c-o);n=l.substring(i,c),n.indexOf(`
`)!==-1&&(n=n.slice(n.lastIndexOf(`
`)+1));break}case"DIV":case"P":default:{const l=ce();if(l&&l.getSelection){const c=l.getSelection();if(!c.rangeCount)return"";const i=c.getRangeAt(0),r=["SPAN","FONT","B","I","U","A","STRIKE","STRONG","EM"];let a=i.startContainer,s=i.startOffset,m=o;for(;a;){if(a.nodeType===Node.TEXT_NODE)if(s-m>0){const g=s-m;n=a.textContent.substring(g,s)+n;break}else n=a.textContent.substring(0,s)+n,m-=s;if(a.nodeType===Node.ELEMENT_NODE&&s>0){for(a=a.childNodes[s-1];a.lastChild;)a=a.lastChild;a.nodeType===Node.TEXT_NODE?s=a.textContent.length:s=0;continue}if(a.nodeType===Node.ELEMENT_NODE&&s===0&&r.indexOf(a.nodeName)===-1)break;if(a.previousSibling){if(a=a.previousSibling,a.nodeType!==Node.TEXT_NODE&&r.indexOf(a.nodeName)===-1)break;for(;a.lastChild;)a=a.lastChild;a.nodeType===Node.TEXT_NODE?s=a.textContent.length:s=0}else{if(a=a.parentNode,a)s=0;else break;if(r.indexOf(a.nodeName)===-1)break}}}}}return n=n.replaceAll("​",""),n=n.replaceAll("⁠",""),n=n.replaceAll("\uFEFF",""),n}function u(t,o,n){const l=" ";function c(m,g){let p=m.lastIndexOf(l,g-1);const C=m.lastIndexOf(`
`,g-1);if(n&&(p=-1),p===-1&&C===-1)return 0;let v=Math.max(p,C);for(;v>0&&(m[v-1]===l||m[v-1]===`
`);)v-=1;return v}const i=t.selectionStart,r=t.value;let a=i;for(let m=0;m<o&&(a=c(r,a),a!==0);m+=1);const s=r.slice(0,a)+r.slice(i);t.value=s,t.setSelectionRange(a,a)}async function T(t,o,n){if(t.tagName==="INPUT"||t.tagName==="TEXTAREA"){u(t,o,n);return}const l=["SPAN","FONT","B","I","U","A","STRIKE","STRONG"],c=" ";n&&(o=1e3);function i(a){let s=a.previousSibling;if(!s){const{parentNode:m}=a;return l.indexOf(m.nodeName)!==-1?i(m):null}for(;s.nodeType!==3&&(s.nodeType===1&&l.indexOf(s.nodeName)!==-1);)s=s.childNodes[s.childNodes.length-1];return s.nodeType===3?s:null}const r=ce();if(r&&r.getSelection){const a=r.getSelection().getRangeAt(0);if(a.collapse(!1),a.collapsed){const s=a.startContainer,m=a.startOffset;let g=s,p=m,C=0,v=0;if(g.nodeType!==3){let F;p!==g.childNodes.length?F=i(g.childNodes[p]):F=i(g),F?(g=F,p=F.textContent.length):C=o}for(;C<o;){const Q=g.textContent.lastIndexOf(c,p-1);if(Q!==-1)C+=1,v+=p-Q,p=Q;else{const ne=i(g);if(ne)g=ne,v+=p,p=ne.textContent.length;else{v+=p,p=0;break}}}for(let F=0;F<v;F+=1)oe(t,{keyCode:D.backspace,type:"beforeinput"})||document.execCommand("delete"),await Z(1)}}}function k(t,o,n){if(["yue-Hant-HK","ja-JP","cmn-Hans-CN","cmn-Hant-TW","zh-HK","zh-CN","zh-TW","th-TH","km-KH","my-MM","lo-LA"].indexOf(j)===-1){y(`prev text:"${o}"`);const c=o.length>0&&[`
`," ",N].indexOf(o[o.length-1])!==-1;if(o=((a,s)=>{let m=a.length;for(;m>0&&s.includes(a[m-1]);)m-=1;return a.slice(0,m)})(o,[" ",N]),L==="ce")t=t.replace(/(^\w{1})|(\s+\w{1})/g,a=>a.toUpperCase());else if(L==="lc")t=t.toLocaleLowerCase();else if(L==="uc")t=t.toLocaleUpperCase();else{const a=L==="lc"||L==="uc";!a&&(h(o)||o.length===0||o===""||o===void 0||o==="null")&&(t=w(t)),!a&&j.startsWith("en-")&&(t=t.replace(/\bi\b/g,()=>"I"))}let r;j.startsWith("fr-")?r=[".",",",")","’","”"," ",N,"-","–","`",`
`]:r=[".",",",";",":","?","!",")","’","”"," ",N,"-","–","`",`
`],o.length>0&&!c&&["(","/","‘","“","-","–","`","’"].indexOf(o[o.length-1])===-1&&r.indexOf(t[0])===-1&&(t=` ${t}`)}else if(j==="th-TH"&&t.length>0&&o.length>0){let c=!1,i=!1;/[a-zA-Z]/.test(o[o.length-1])&&(c=!0),/[a-zA-Z]/.test(t[0])&&(i=!0),(!c&&i||c&&!i&&t[0]!==" ")&&(t=` ${t}`)}return y(`finalText "${t}"`),t}function S(t){const o=U(),n=V(),l=le();if(!n.body.classList.contains("voicein_ready")){const c=be.indexOf(o)!==-1,i=H("EnablePasteHandler")==="true";let r=window.location.href.indexOf("wp-admin")!==-1;try{window.location.href.startsWith("blob:")&&window.parent&&window.parent.window.location.href.indexOf("wp-admin")!==-1&&(r=!0)}catch(s){y("Cannot access parent window:",s)}c||i||r?(y("[PrepTarget] Prepped Target",n.body),l.addEventListener("paste",s=>{ee&&document.activeElement&&document.activeElement.nodeName!=="INPUT"&&(s.stopImmediatePropagation(),y("Stopped Paste Propogation"))},!0),n.body.classList.add("voicein_ready")):(y("[PrepTarget] Paste Trapper Not Enabled"),n.body.classList.add("voicein_ready"))}}function E(t){for(let o=0;o<t.length;o+=1){let n=t[o];n.length>0&&n[0]===" "&&(n=n.slice(1),t[o]=n),n.length>0&&n[n.length-1]===" "&&(t[o]=n.slice(0,n.length-1))}}const x=navigator.platform.toUpperCase().indexOf("MAC")>=0?91:17;async function K(t,o){await chrome.runtime.sendMessage({message_id:"copy_text",value:t})&&o(),await Z(50)}async function z(t,o){try{if(navigator.clipboard&&navigator.clipboard.writeText){try{await navigator.clipboard.writeText(t),o()}catch(n){console.error("Could not clipboard write text: ",n),await K(t,o)}document.activeElement&&document.activeElement.nodeName==="INPUT"&&document.activeElement.dispatchEvent(new KeyboardEvent("keyup",{keyCode:x})),await Z(50)}else await K(t,o)}catch(n){console.error("Could not copy text: ",n),te(n)}return 0}function R(t){t=t.replace("<","&lt;").replace(">","&gt;"),chrome.runtime.sendMessage({message_id:"forward",payload:{action:"show_notification",message:`Upgrade to <a href="https://dictanote.co/voicein/plus/?utm_source=extension&utm_medium=notification&utm_campaign=command" target="_blank" class="external">Voice In Plus</a> to use the ${t} command.`}})}async function $(t,o){switch(t){case"<copy>":o.execCommand("copy");break;case"<cut>":o.execCommand("cut");break;case"<paste>":o.execCommand("paste");break;case"<delete>":o.execCommand("delete");break;case"<selectall>":o.execCommand("selectAll");break;case"<bold>":o.execCommand("bold");break;case"<italic>":o.execCommand("italic");break;case"<underline>":o.execCommand("underline");break;case"<strikethrough>":o.execCommand("strikeThrough");break;case"<indent>":o.execCommand("indent");break;case"<outdent>":o.execCommand("outdent");break;case"<scrolltop>":X(-1,1e3,0);break;case"<scrollbottom>":X(1,1e3,Math.max(document.body.scrollHeight-window.innerHeight,0));break;case"<scrollup>":X(-1,1e3,Math.max(window.scrollY-Math.max(window.innerHeight-100,0),0));break;case"<scrolldown>":X(1,1e3,window.scrollY+Math.max(window.innerHeight-100,0));break;case"<capson>":W=!0;break;case"<capsoff>":W=!1;break;case"<capitalize>":M=!0;break;case"<stop>":chrome.runtime.sendMessage({message_id:"stop_recognition"});break;case"<enter>":{const n={bubbles:!0,cancelable:!0,key:"Enter",keyCode:13,which:13,composed:!0},l=new KeyboardEvent("keydown",n);b.dispatchEvent(l);const c=new KeyboardEvent("keypress",n);b.dispatchEvent(c);const i=new KeyboardEvent("keyup",n);b.dispatchEvent(i),f="";break}case"<tab>":{const n={bubbles:!0,cancelable:!0,key:"Tab",keyCode:9,which:9,composed:!0},l=new KeyboardEvent("keydown",n);b.dispatchEvent(l);const c=new KeyboardEvent("keyup",n);b.dispatchEvent(c);break}case"<deleteword>":{if(!O){R(t);break}T(b,1);break}case"<deleteline>":{if(!O){R(t);break}T(b,1,!0);break}case"<undo>":{if(!O){R(t);break}if(!o.execCommand("undo")){const c=navigator.platform.toUpperCase().indexOf("MAC")>=0?"metaKey":"ctrlKey",i={keyCode:D.z,type:"keydown",[c]:!0},r={keyCode:D.z,type:"keyup",[c]:!0};oe(b,i),oe(b,r)}break}default:if(t.startsWith("<lang:")&&t.endsWith(">")){const n=t.substring(6,t.length-1);chrome.runtime.sendMessage({message_id:"update_language",language:n})}else if(t.startsWith("<press:")&&t.endsWith(">")){if(!O){R(t);break}chrome.runtime.sendMessage({message_id:"press_key",key:t.substring(7,t.length-1)}),await Z(100)}else if(t.startsWith("<deleteword:")&&t.endsWith(">")){if(!O){R(t);break}const n=parseInt(t.substring(12,t.length-1),10);T(b,n)}else if(t.startsWith("<backspace:")&&t.endsWith(">")){if(!O){R(t);break}let n=parseInt(t.substring(11,t.length-1),10);for(;n>0;)o.execCommand("delete"),n-=1}else if(t.startsWith("<case:")&&t.endsWith(">")){const n=t.substring(6,t.length-1).toLocaleLowerCase(),l=["lower","upper","capitalize","default","sentence"],c=["lc","uc","ce","df","sc"];if(l.indexOf(n)!==-1)return L=c[l.indexOf(n)],chrome.runtime.sendMessage({message_id:"update_change_case",changeCase:L}),0}else if(t.startsWith("<click:")&&t.endsWith(">")){const n=t.substring(7,t.length-1).toLocaleLowerCase();fe(n)}else return y("Unknown command ",t),-1}return 0}async function ie(t,o){y(`pasteTextIntoTarget "${o}"`),S(),o=o.replaceAll("<newline>",`
`),o=o.replaceAll("<newparagraph>",`

`);const n=o.split(B),l=V(),c=()=>{l.execCommand("paste",!1)};n.length>1&&E(n);for(let i=0;i<n.length;i+=1){let r=n[i];if(r)switch(r){case"<newparagraph>":{await z(`

`,c),f="";break}case"<insertspace>":{await z(N,c),f+=N;break}case"<newline>":{await z(`
`,c),f="";break}default:{if(r.startsWith("<")&&r.endsWith(">")&&await $(r,l)===0)break;M&&(r=w(r),M=!1),W&&(r=r.toLocaleUpperCase());const a=k(r,f);await z(a,c),f+=a}}}}async function Fe(t,o){y(`insertTextIntoTextArea "${o}"`);function n(i,r){const a=i.selectionStart,s=i.selectionEnd,m=i.value;i.value=m.substring(0,a)+r+m.substring(s);const g=a+r.length;i.setSelectionRange(g,g)}const l=o.split(B);l.length>1&&E(l);const c=V();for(let i=0;i<l.length;i+=1){let r=l[i];if(r)switch(r){case"<newparagraph>":{n(t,`

`),f="";break}case"<insertspace>":{n(t,N),f+=N;break}case"<newline>":{n(t,`
`),f="";break}default:{if(r.startsWith("<")&&r.endsWith(">")&&await $(r,c)===0)break;t.blur(),t.focus(),M&&(r=w(r),M=!1),W&&(r=r.toLocaleUpperCase());const a=k(r,f);n(t,a),f+=a,document.activeElement.dispatchEvent(new KeyboardEvent("keyup",{keyCode:x})),t.blur(),t.focus()}}}}async function Oe(t,o){y(`insertTextIntoContentEditable "${o}"`);let n,l,c;const i=V(),r=le();if(r&&r.getSelection&&(n=r.getSelection(),n.getRangeAt&&n.rangeCount)){l=n.getRangeAt(0),l.collapsed||l.deleteContents();let a=!1;const s=o.split(B);s.length>1&&E(s);for(let m=0;m<s.length;m+=1){let g=s[m];if(g)switch(g){case"<newline>":{c=document.createElement("span"),c.innerHTML="<br>",l.insertNode(c),l.collapse(!0),l.setStartAfter(c),l.setEndAfter(c),f="";break}case"<newparagraph>":{c=document.createElement("br"),l.insertNode(c),l.collapse(!0),l.setStartAfter(c),l.setEndAfter(c),c=document.createElement("br"),l.insertNode(c),l.collapse(!0),l.setStartAfter(c),l.setEndAfter(c),f="";break}case"<paste>":{i.execCommand("paste"),a=!0;break}case"<insertspace>":{g=N,c=document.createTextNode(g),l.insertNode(c),l.collapse(!0),l.setStart(c,g.length),l.setEnd(c,g.length),f+=g;break}default:{if(g.startsWith("<")&&g.endsWith(">")&&await $(g,i)===0){a=!0;break}M&&(g=w(g),M=!1),W&&(g=g.toLocaleUpperCase());const p=k(g,f);c=document.createTextNode(p),l.insertNode(c),l.collapse(!0),l.setStart(c,p.length),l.setEnd(c,p.length),f+=p;break}}}a||(n.removeAllRanges(),n.addRange(l)),c&&c.parentNode&&c.parentNode.normalize()}}function ze(t){const o=[{actionGroups:[],urlRegexes:["facebook\\.com","messenger\\.com"]},{actionGroups:[],selectors:['[contenteditable]:not([contenteditable="false"])'],urlRegexes:["docs\\.google\\.com/spreadsheets"]},{name:"htmlFill",actions:[{actionType:"dispatchEvent",event:{event:"ClipboardEvent",eventDataFormat:{clipboardData:[{type:"text/plain"},{type:"text/html"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0},eventType:"paste"}},{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"},{type:"text/html"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"beforeinput"}},{actionType:"execCommand",command:"insertHTML",fillFormat:{type:"text/html"}}],selectors:['[contenteditable]:not([contenteditable="false"])']},{name:"htmlFillInput",actions:[{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"},{type:"text/html"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"beforeinput"}},{actionType:"execCommand",command:"insertText",fillFormat:{type:"text/plain"}}],selectors:["input","textarea"]},{name:"unused",actions:[{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"},{type:"text/html"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"beforeinput"}},{actionType:"fillElementValue",fillFormat:{type:"text/plain"}},{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"},{type:"text/html"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"input"}},{actionType:"dispatchEvent",event:{event:"InputEvent",eventInit:{bubbles:!0,cancelable:!1,composed:!1},eventType:"change"}}],selectors:["input","textarea"]},{name:"txtFill",actions:[{actionType:"dispatchEvent",event:{event:"ClipboardEvent",eventDataFormat:{clipboardData:[{type:"text/plain"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0},eventType:"paste"}},{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"beforeinput"}},{actionType:"execCommand",command:"insertText",fillFormat:{type:"text/plain"}}],selectors:['[contenteditable]:not([contenteditable="false"])']},{name:"txtFill2",actions:[{actionType:"dispatchEvent",event:{event:"InputEvent",eventDataFormat:{dataTransfer:[{type:"text/plain"}]},eventInit:{bubbles:!0,cancelable:!0,composed:!0,detail:0,inputType:"insertFromPaste"},eventType:"beforeinput"}},{actionType:"execCommand",command:"insertText",fillFormat:{type:"text/plain"}}],selectors:['[contenteditable]:not([contenteditable="false"])']}],n=U();return n==="app.hubspot.com"||n.endsWith("twitter.com")||H("EnableTxtFill")==="true"||n==="www.reddit.com"||n==="dictanote.co"||n==="answers.microsoft.com"||n==="www.facebook.com"?o[5]:H("EnableHTMLFill")==="true"?o[2]:n==="mail.google.com"?o[6]:t.tagName==="INPUT"||t.tagName==="TEXTAREA"?o[3]:o[2]}function J(t,o,n,l){let c=o;return l&&l.localName==="input"?c=t.replace(/(\S)\n+(\S)/g,"$1 $2"):(l&&l.localName==="textarea"||n&&n.type==="text/plain")&&(c=t),c}function Re(t,o){if(t.event.eventType==="paste"&&!o.plainText&&!o.richText)return!0;const n=t.event,{eventInit:l,eventDataFormat:c}=n;if(c){if(c.dataTransfer){const r=new DataTransfer;c.dataTransfer.forEach(a=>{const s=J(o.plainText,o.richText,a,o.element);r.setData(a.type,s)}),l.dataTransfer=r}if(c.clipboardData){const r=new DataTransfer;c.clipboardData.forEach(a=>{const s=J(o.plainText,o.richText,a,o.element);r.setData(a.type,s)}),l.clipboardData=r}}const i=new window[n.event](n.eventType,l);return o.element.dispatchEvent(i)}function De(t,o){let n=t.customFillValue;n||(n=t.fillFormat?J(o.plainText,o.richText,t.fillFormat,o.element):void 0),o.element.ownerDocument.execCommand(t.command,!1,n)}function He(t,o){t.element.setSelectionRange(o,o)}function Ie(t,o){if(!(o.element instanceof HTMLInputElement||o.element instanceof HTMLTextAreaElement))throw new Error("fillElementValue received element not of type input or textarea");const n=o.element,l=o.replaceTextSuffix,c=J(o.plainText,o.richText,t.fillFormat,o.element)+l,i=n.selectionStart,r=n.selectionEnd;n.value=n.value.substring(0,i)+c+n.value.substring(r,n.value.length),He(o,i+c.length)}async function re(t,o){y(`insertAdvanced "${o}"`),S();const n=ze(t),l=V();function c(a){return a=he(a),a.length>0&&a[0]===" "&&(a=`&nbsp;${a.substring(1)}`),a=a.replaceAll("  "," &nbsp;"),a=a.replaceAll(`
`,"<br>"),`${a}`}function i(a,s){let m=s;m.endsWith(`
`)&&(m+=`
`),y(`strategy=${n.name} text="${s}" html="${c(m)}"`);const g={element:a,plainText:s,richText:c(m),replaceTextSuffix:""};let p=!0;for(let C=0;C<n.actions.length;C+=1){const v=n.actions[C];if(p||v.forceExecution)switch(v.actionType){case"dispatchEvent":p=Re(v,g),p&&y(`dispatch failed ${g.element}`);break;case"execCommand":De(v,g);break;case"fillElementValue":Ie(v,g);break;default:y(`Unknown action type: ${v.actionType}`)}}}o=o.replaceAll("<newparagraph>",`

`),o=o.replaceAll("<newline>",`
`),o=o.replaceAll("<insertspace>",N);const r=o.split(B);r.length>1&&E(r);for(let a=0;a<r.length;a+=1){let s=r[a];if(s)switch(s){default:{if(s.startsWith("<")&&s.endsWith(">")&&await $(s,l)===0)break;M&&(s=w(s),M=!1),W&&(s=s.toLocaleUpperCase());const m=k(s,f);i(t,m),f+=m}}}}if(e.length>0){let t=function(c){const i=new Date;return c.replace(/yyyy/g,i.getFullYear()).replace(/yy/g,i.getFullYear().toString().slice(-2)).replace(/MM/g,(i.getMonth()+1).toString().padStart(2,"0")).replace(/M/g,i.getMonth()+1).replace(/dd/g,i.getDate().toString().padStart(2,"0")).replace(/d/g,i.getDate()).replace(/HH/g,i.getHours().toString().padStart(2,"0")).replace(/H/g,i.getHours()).replace(/hh/g,(i.getHours()%12||12).toString().padStart(2,"0")).replace(/h/g,i.getHours()%12||12).replace(/mm/g,i.getMinutes().toString().padStart(2,"0")).replace(/m/g,i.getMinutes()).replace(/ss/g,i.getSeconds().toString().padStart(2,"0")).replace(/s/g,i.getSeconds()).replace(/a/g,i.getHours()>=12?"pm":"am").replace(/A/g,i.getHours()>=12?"PM":"AM")};e=e.trimLeft();const o=U(),n=Ce();Ee(o,n)?f=f.slice(-6):f=d(b,6),e=e.replace(/<date(?::([^>]+))?>/g,(c,i)=>i?t(i):new Date().toLocaleDateString()),ee=!0;try{if(b.tagName==="INPUT"||b.tagName==="TEXTAREA")I?H("VoiceInAdvanced2")==="true"?ie(b,e):re(b,e):Fe(b,e);else{const c=U();if(I&&ye.indexOf(c)===-1){const i=["www.canva.com"];H("VoiceInAdvanced2")==="true"||i.indexOf(c)!==-1?ie(b,e):re(b,e)}else Oe(b,e)}}catch(c){console.error(c),te(c)}return ee=!1,e.length}return 0}function Me(e,w){if(G="",!O&&Y)return;const h=Se();(h.targetable||w&&h.target&&h.target.tagName!=="IFRAME")&&(b=h.target,Ae(e))}async function Pe(){const e=await chrome.storage.local.get("changeCase");e.changeCase&&(L=e.changeCase)}function _e(){try{return window.self!==window.top}catch{return!0}}async function q(){await Le(),_e()&&document.addEventListener("keydown",e=>{e.keyCode===13&&G&&(e.stopImmediatePropagation(),e.preventDefault(),chrome.runtime.sendMessage({message_id:"restart_recognition"}),G="")},!0)}async function Le(){const e=U();if(ge(e)&&(I=!0),!(await chrome.storage.local.get("pro")).pro){const d=xe();Y=!1,Y=me.some(u=>d.endsWith(u)),(d.startsWith("app.")||d.indexOf("crm")!==-1||d.indexOf("health")!==-1)&&(Y=!0);return}if(O=!0,I=!0,[].indexOf(e)!==-1)y("paste mode disabled - exception"),I=!1;else{const d=await chrome.storage.local.get("no_advancedmode_domains");if(d.no_advancedmode_domains){const u=U(),T=d.no_advancedmode_domains;let k=!1;for(let S=0;S<T.length;S+=1)if(u.endsWith(T[S])){k=!0;break}k&&(I=!1)}}Pe(),y("Loaded settings")}ve()})();
